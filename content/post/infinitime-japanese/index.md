---
title: "PineTimeを日本語化する回"
date: 2023-11-10T22:46:29+09:00
categories:
- howto
tags:
- PineTime
thumbnailImage: /2023/11/infinitime-japanese/after.jpg
---

InfiniTime 1.13 on PineTime の通知に日本語が表示されないのが不便なのでどうにかします。

## フォントを外部フラッシュに入れ… RAMが足りない!
PineTimeには、CPU内蔵の64KB RAMと512KB フラッシュROM、さらにストレージとして4MBのSPI外部フラッシュが搭載されている。512KBしかない内蔵フラッシュの空きには当然日本語の全文字のフォントデータが入らないので、できれば外部フラッシュに逃がしたい。

<!--more-->

まずは、[1.11でInfiniTimeが外部フラッシュへのリソースの格納に対応](https://github.com/InfiniTimeOrg/InfiniTime/blob/1.13.0/doc/ExternalResources.md)したので、この方法で日本語フォントを追加しようとした。  
英字+日本語のひらがな+カタカナ+記号+CJK統合漢字のフォントが4MBの外部フラッシュに余裕で収まるサイズ(約787K)に収まったので行けると思ったら、いざフォントを変更する段になって描画前にこの巨大フォントをたった64KBのRAMにロードしないといけないことに気づいた。

漢字数を小学校レベルにまで削っても128KB近くになるので、どうにか直接アクセスできる内蔵フラッシュに押しこむしかない。

## じゃあ文字種を削って内蔵フラッシュに…入らない!
[この記事](https://qiita.com/skyfish20ch/items/e5437221447b4307d299#%E6%97%A5%E6%9C%AC%E8%AA%9E%E5%8C%96)のように内蔵フラッシュにフォントデータを入れようとしてみたが、バージョンアップで元々のフラッシュ使用量が当時より増えたので、フォントを追加すると容量オーバーするようになってしまっていた。

内蔵フラッシュにフォントを入れるとフラッシュが溢れ、外部フラッシュに入れるとRAMが溢れる!

## アプリを削って無理やり押し込む
使わない内蔵アプリ4つ (2048, ポン, お絵描きアプリ, メトロノーム)を削除したらなんとか内蔵フラッシュに収まった。やったね!

![内蔵フラッシュの容量がギリギリの図](flash.png)

## できあがり
開発キットを持っていることを忘れていきなり実機にインストールしてしまったけど、無事うまく行った。

{{<image classes="center fancybox nocaption" src="after.jpg" title="日本語化後" thumbnail-width="400px">}}

## おまけ
ビルドしたバイナリを *[ここ](https://github.com/ngkz/InfiniTime-Japanese/releases)* に置いておきました。よかったら使ってください

## 参考
 * [PineTimeをいじってみる#日本語化](https://qiita.com/skyfish20ch/items/e5437221447b4307d299#%E6%97%A5%E6%9C%AC%E8%AA%9E%E5%8C%96)

   大変参考になりました。ありがとうございます。
